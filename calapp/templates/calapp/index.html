{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Simple Calculator</title>
    <link rel="stylesheet" href="{% static 'calapp/css/calapp.css' %}" />
</head>
<body>
    <div class="calc-container">
        <form method="POST">
            {% csrf_token %}

            <!-- Hidden field to send button value to Django -->
            <input type="hidden" name="btn" id="btn-hidden">

            <!-- Expression and Result -->
            <input type="text" name="expression" class="display" value="{{ expression }}" readonly />
            <input type="text" class="result" value="{{ result }}" readonly />

            <div class="buttons">
                <!-- Number buttons -->
                <button type="button" name="btn" value="7">7</button>
                <button type="button" name="btn" value="8">8</button>
                <button type="button" name="btn" value="9">9</button>
                <button class="op" type="button" name="btn" value="/">/</button>

                <button type="button" name="btn" value="4">4</button>
                <button type="button" name="btn" value="5">5</button>
                <button type="button" name="btn" value="6">6</button>
                <button class="op" type="button" name="btn" value="*">*</button>

                <button type="button" name="btn" value="1">1</button>
                <button type="button" name="btn" value="2">2</button>
                <button type="button" name="btn" value="3">3</button>
                <button class="op" type="button" name="btn" value="-">-</button>

                <button type="button" name="btn" value="0">0</button>
                <button type="button" name="btn" value=".">.</button>
                <button class="op" type="button" name="btn" value="+">+</button>

                <!-- "=" triggers form submit -->
                <button class="op" type="button" name="btn" value="=">=</button>

                <!-- Clear and Backspace -->
                <button class="clear" type="button" name="btn" value="C">C</button>
                <button class="clear" type="button" name="btn" value="backspace">âŒ«</button>
            </div>
        </form>
    </div>

    <!-- JavaScript to prevent reload -->
    <script>
        const display = document.querySelector('input[name="expression"]');
        const resultField = document.querySelector('input.result');
        const hiddenBtn = document.getElementById("btn-hidden");
        const form = document.querySelector('form');

        document.querySelectorAll('button[name="btn"]').forEach(btn => {
            btn.addEventListener('click', function () {
                let val = this.value;

                if (val === "=") {
                    hiddenBtn.value = "=";
                    form.submit();        // send to Django
                }
                else if (val === "C") {
                    hiddenBtn.value = "C";
                    form.submit();        // send to Django
                }
                else if (val === "backspace") {
                    hiddenBtn.value = "backspace";
                    form.submit();        // send to Django
                }
                else {
                    display.value += val;  // no reload
                }
            });
        });
    </script>

</body>
</html>
