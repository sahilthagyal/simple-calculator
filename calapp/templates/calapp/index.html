{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Simple Calculator</title>
    <link rel="stylesheet" href="{% static 'calapp/css/calapp.css' %}" />
</head>
<body>
    <div class="calc-container">
        <form method="POST">
            {% csrf_token %}

            <!-- Hidden input to send "=" button -->
            <input type="hidden" name="btn" id="btn-hidden">

            <!-- Display fields -->
            <input type="text" name="expression" class="display" value="{{ expression }}" readonly />
            <input type="text" class="result" value="{{ result }}" readonly />

            <div class="buttons">
                <!-- Number buttons -->
                <button type="button" name="btn" value="7">7</button>
                <button type="button" name="btn" value="8">8</button>
                <button type="button" name="btn" value="9">9</button>
                <button type="button" name="btn" value="/">/</button>

                <button type="button" name="btn" value="4">4</button>
                <button type="button" name="btn" value="5">5</button>
                <button type="button" name="btn" value="6">6</button>
                <button type="button" name="btn" value="*">*</button>

                <button type="button" name="btn" value="1">1</button>
                <button type="button" name="btn" value="2">2</button>
                <button type="button" name="btn" value="3">3</button>
                <button type="button" name="btn" value="-">-</button>

                <button type="button" name="btn" value="0">0</button>
                <button type="button" name="btn" value=".">.</button>
                <button type="button" name="btn" value="+">+</button>

                <!-- ONLY "=" reloads -->
                <button class="op" type="button" name="btn" value="=">=</button>

                <!-- C & backspace = no reload -->
                <button class="clear" type="button" name="btn" value="C">C</button>
                <button class="clear" type="button" name="btn" value="backspace">âŒ«</button>
            </div>
        </form>
    </div>

    <!-- JS section -->
    <script>
        const display = document.querySelector('input[name="expression"]');
        const resultField = document.querySelector('input.result');
        const hiddenBtn = document.getElementById("btn-hidden");
        const form = document.querySelector('form');

        document.querySelectorAll('button[name="btn"]').forEach(btn => {
            btn.addEventListener('click', () => {
                let val = btn.value;

                if (val === "=") {
                    hiddenBtn.value = "=";  // send "=" to backend
                    form.submit();         // reload ONLY for equal
                } 
                else if (val === "C") {
                    display.value = "";     // clear without reload
                    resultField.value = "";
                } 
                else if (val === "backspace") {
                    display.value = display.value.slice(0, -1);
                } 
                else {
                    display.value += val;   // add number/operator
                }
            });
        });
    </script>

</body>
</html>
